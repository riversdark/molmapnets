---

title: nets


keywords: fastai
sidebar: home_sidebar

summary: "The neural network architects."
description: "The neural network architects."
nb_path: "03_nets.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 03_nets.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our implementation of the networks will follow this architecture:</p>
<p><img src="https://github.com/shenwanxiang/bidd-molmap/blob/master/paper/images/net.png?raw=1" alt=""></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Feature-extraction">Feature extraction<a class="anchor-link" href="#Feature-extraction"> </a></h2><p>When building complex networks it's better to build and test the smaller components first, then combine them together. This way we can also reuse the individual parts easily.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Convolutional-block">Convolutional block<a class="anchor-link" href="#Convolutional-block"> </a></h3><p>This block takes the descriptor or  fingerprint maps as input, and returns outputs of a max pooling layer.</p>
<ul>
<li>Descriptor: <code>13*37*37</code> -&gt; <code>48*37*37</code> -&gt; <code>48*19*19</code></li>
<li>Fingerprint: <code>3*37*36</code> -&gt; <code>48*37*36</code> -&gt; <code>48*19*18</code></li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Convnet" class="doc_header"><code>class</code> <code>Convnet</code><a href="https://github.com/riversdark/molmapnets/tree/master/molmapnets/nets.py#L12" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Convnet</code>(<strong><code>C_in</code></strong>=<em><code>13</code></em>, <strong><code>C_out</code></strong>=<em><code>48</code></em>, <strong><code>conv_size</code></strong>=<em><code>13</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Convolutional feature extraction Block</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's test it on the descriptor and fingerprint maps</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">convnet</span> <span class="o">=</span> <span class="n">Convnet</span><span class="p">()</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">37</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">convnet</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/olivier/opt/anaconda3/envs/molmap/lib/python3.6/site-packages/torch/nn/functional.py:718: UserWarning: Named tensors and all their associated APIs are an experimental feature and subject to change. Please do not use them for anything important until they are released as stable. (Triggered internally at  ../c10/core/TensorImpl.h:1156.)
  return torch.max_pool2d(input, kernel_size, stride, padding, dilation, ceil_mode)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 48, 19, 19])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">convnet</span> <span class="o">=</span> <span class="n">Convnet</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">36</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">convnet</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 48, 19, 18])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Inception-block">Inception block<a class="anchor-link" href="#Inception-block"> </a></h3><p>After the convolutional block, the resulting feature maps will further pass through some inception blocks.</p>
<p>The inceptions implemented here are the na√Øve Google inceptions. It passes the input through multiple convolutional layers and then concatenate the output. This inception block is actually two smaller inception blocks bridged with a max pooling layer. First the small inception block:</p>
<ul>
<li>Descriptor: <code>48*19*19</code> -&gt; 3 outputs of <code>32*19*19</code> -&gt; <code>96*19*19</code>, |-&gt; <code>96*10*10</code> -&gt; 3 outputs of <code>64*10*10</code> -&gt; <code>192*10*10</code></li>
<li>Fingerprint: <code>48*19*18</code> -&gt; 3 outputs of <code>32*19*18</code> -&gt; <code>96*19*18</code>, |-&gt; <code>96*10*9</code> -&gt; 3 outputs of <code>64*10*9</code> -&gt; <code>192*10*9</code></li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Inception" class="doc_header"><code>class</code> <code>Inception</code><a href="https://github.com/riversdark/molmapnets/tree/master/molmapnets/nets.py#L28" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Inception</code>(<strong><code>C_in</code></strong>=<em><code>48</code></em>, <strong><code>C_out</code></strong>=<em><code>32</code></em>, <strong><code>stride</code></strong>=<em><code>1</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Naive Google Inception Block</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inception</span> <span class="o">=</span> <span class="n">Inception</span><span class="p">()</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">inception</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 96, 19, 19])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inception</span> <span class="o">=</span> <span class="n">Inception</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">inception</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 192, 10, 10])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inception</span> <span class="o">=</span> <span class="n">Inception</span><span class="p">()</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">inception</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 96, 19, 18])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inception</span> <span class="o">=</span> <span class="n">Inception</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">inception</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 192, 10, 9])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And the double inception block:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DoubleInception" class="doc_header"><code>class</code> <code>DoubleInception</code><a href="https://github.com/riversdark/molmapnets/tree/master/molmapnets/nets.py#L56" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DoubleInception</code>(<strong><code>C_in1</code></strong>=<em><code>48</code></em>, <strong><code>C_out1</code></strong>=<em><code>32</code></em>, <strong><code>stride1</code></strong>=<em><code>1</code></em>, <strong><code>C_in2</code></strong>=<em><code>96</code></em>, <strong><code>C_out2</code></strong>=<em><code>64</code></em>, <strong><code>stride2</code></strong>=<em><code>1</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Double Inception Block</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">double_inception</span> <span class="o">=</span> <span class="n">DoubleInception</span><span class="p">()</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">double_inception</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 192, 10, 10])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">double_inception</span> <span class="o">=</span> <span class="n">DoubleInception</span><span class="p">()</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">double_inception</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 192, 10, 9])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Global-max-pooling">Global max pooling<a class="anchor-link" href="#Global-max-pooling"> </a></h3><p>There is no global max pooling layer in PyTorch but this is very easy to realise.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 192])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Fully-connected-block">Fully connected block<a class="anchor-link" href="#Fully-connected-block"> </a></h3><p>At the end of the network the data passes through several fully connected layers.</p>
<p>If the MolMap network is single path:</p>
<ul>
<li><code>192</code> -&gt; <code>128</code> -&gt; <code>32</code></li>
</ul>
<p>And if double path:</p>
<ul>
<li><code>384</code> -&gt; <code>256</code> -&gt; <code>128</code> -&gt; <code>32</code></li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SinglePathFullyConnected" class="doc_header"><code>class</code> <code>SinglePathFullyConnected</code><a href="https://github.com/riversdark/molmapnets/tree/master/molmapnets/nets.py#L73" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SinglePathFullyConnected</code>(<strong><code>C1</code></strong>=<em><code>192</code></em>, <strong><code>C2</code></strong>=<em><code>128</code></em>, <strong><code>C3</code></strong>=<em><code>32</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Fully connected layers for single path MolMap nets</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">single_path_fully_connected</span> <span class="o">=</span> <span class="n">SinglePathFullyConnected</span><span class="p">()</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">192</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">single_path_fully_connected</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 32])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DoublePathFullyConnected" class="doc_header"><code>class</code> <code>DoublePathFullyConnected</code><a href="https://github.com/riversdark/molmapnets/tree/master/molmapnets/nets.py#L88" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DoublePathFullyConnected</code>(<strong><code>C1</code></strong>=<em><code>384</code></em>, <strong><code>C2</code></strong>=<em><code>256</code></em>, <strong><code>C3</code></strong>=<em><code>128</code></em>, <strong><code>C4</code></strong>=<em><code>32</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Fully connected layers for double paths MolMap nets</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">double_path_fully_connected</span> <span class="o">=</span> <span class="n">DoublePathFullyConnected</span><span class="p">()</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">384</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">double_path_fully_connected</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 32])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Single-Path-Molecular-Mapping-network">Single Path Molecular Mapping network<a class="anchor-link" href="#Single-Path-Molecular-Mapping-network"> </a></h2><p>Descriptor map or Fingerprint map only. The two have identical network structures, and only differs in data shape.</p>
<ul>
<li>descriptor: <code>13*37*37</code> -&gt; <code>32</code></li>
<li>fingerprint: <code>3*37*36</code> -&gt; <code>32</code></li>
</ul>
<p>The output layer is not included.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SinglePathMolMapNet" class="doc_header"><code>class</code> <code>SinglePathMolMapNet</code><a href="https://github.com/riversdark/molmapnets/tree/master/molmapnets/nets.py#L105" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SinglePathMolMapNet</code>(<strong><code>conv_in</code></strong>=<em><code>13</code></em>, <strong><code>conv_size</code></strong>=<em><code>13</code></em>, <strong><code>FC</code></strong>=<em><code>[128, 32]</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Single Path Molecular Mapping Network</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">single_path</span> <span class="o">=</span> <span class="n">SinglePathMolMapNet</span><span class="p">()</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">37</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">single_path</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 32])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">single_path</span> <span class="o">=</span> <span class="n">SinglePathMolMapNet</span><span class="p">(</span><span class="n">conv_in</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">36</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">single_path</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 32])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Double-Path-Molecular-Mapping-network">Double Path Molecular Mapping network<a class="anchor-link" href="#Double-Path-Molecular-Mapping-network"> </a></h2><p>Both the descriptor map and Fingerprint map will pass through the convolutional block, then the double inception block, and their results are then combined, before finally pass through the fully connected layers.</p>
<p>After convolutional and double inception block:</p>
<ul>
<li>descriptor: <code>13*37*37</code> -&gt; <code>192*10*10</code></li>
<li>fingerprint: <code>3*37*36</code> -&gt; <code>192*10*9</code></li>
</ul>
<p>After global max pooling:</p>
<ul>
<li>descriptor: <code>192*10*10</code> -&gt; <code>192</code></li>
<li>fingerprint: <code>192*10*9</code> -&gt; <code>192</code></li>
</ul>
<p>After Concatenation and fully connected blocks:</p>
<ul>
<li><code>192 + 192</code> -&gt; <code>384</code> -&gt; <code>32</code></li>
</ul>
<p>The output layer is not included.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DoublePathMolMapNet" class="doc_header"><code>class</code> <code>DoublePathMolMapNet</code><a href="https://github.com/riversdark/molmapnets/tree/master/molmapnets/nets.py#L126" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DoublePathMolMapNet</code>(<strong><code>conv_in1</code></strong>=<em><code>13</code></em>, <strong><code>conv_in2</code></strong>=<em><code>3</code></em>, <strong><code>conv_size</code></strong>=<em><code>13</code></em>, <strong><code>FC</code></strong>=<em><code>[256, 128, 32]</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Double Path Molecular Mapping Network</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">double_path</span> <span class="o">=</span> <span class="n">DoublePathMolMapNet</span><span class="p">()</span>

<span class="n">i1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">37</span><span class="p">))</span>
<span class="n">i2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">36</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">double_path</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 32])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Resnet-block">Resnet block<a class="anchor-link" href="#Resnet-block"> </a></h2><p>Currently not used</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Resnet" class="doc_header"><code>class</code> <code>Resnet</code><a href="https://github.com/riversdark/molmapnets/tree/master/molmapnets/nets.py#L154" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Resnet</code>(<strong><code>C</code></strong>, <strong><code>conv_size</code></strong>) :: <code>Module</code></p>
</blockquote>
<p>Naive Google Inception Block</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">resnet</span> <span class="o">=</span> <span class="n">Resnet</span><span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">resnet</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([10, 48, 19, 18])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

